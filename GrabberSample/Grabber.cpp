#include "pch.h"

#include "Grabber/Grabber.h"
#include "Common/Version/Manager.h"
#include "Worker.h"

namespace Standard
{
	namespace Grabber
	{
		//! カメラの制御を行う基礎クラス
		static CWorker _device;

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			バージョンのクラスを取得
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API Version::CObject GetVersion()
		{
			Version::CObject ret;

			Version::CManager& versionManager = Version::CManager::Instance();

			// バージョンのクラスを取得
			ret = versionManager.GetVersion();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			例外を通知する関数の登録
		/// @detail			例外の発生時に呼び出されたい関数を指定する
		/// @param[in]		object	呼び出されたい関数
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void AttachFunctionException(std::function<void(const Exception::CObject&)> object)
		{
			// 例外を通知する関数の登録
			_device.AttachFunctionException(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			例外を通知する関数の解除
		/// @detail			例外の発生時に呼び出される関数を解除する
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void DetachFunctionException()
		{
			// 例外を通知する関数の解除
			_device.DetachFunctionException();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			初期化
		/// @param[in]		object	デフォルトな設定クラス
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void Initialize(const Setting::CDefault& object)
		{
			// 初期化
			_device.Initialize(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			破棄
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void Destroy()
		{
			// 破棄
			_device.Destroy();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			接続
		/// @param[in]		object	接続の設定クラス
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void Connect(const Setting::CConnect& object)
		{
			// 接続
			_device.Connect(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			切断
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void Disconnect()
		{
			// 切断
			_device.Disconnect();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			取り込みの条件クラスを取得
		/// @return			取り込みの条件クラス
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API Condition::CCapture GetCaptureCondition()
		{
			Condition::CCapture ret;

			// 取り込みの条件クラスを取得
			ret = _device.GetCaptureCondition();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			アナログゲインを読み込み
		/// @return			アナログゲイン値
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API double ReadAnalogGain()
		{
			double ret = 0;

			// アナログゲインを読み込み
			ret = _device.ReadAnalogGain();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			アナログゲインを書き込み
		/// @param[in]		value	アナログゲイン値
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void WriteAnalogGain(double value)
		{
			// アナログゲインを書き込み
			_device.WriteAnalogGain(value);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			デジタルゲインを読み込み
		/// @return			デジタルゲイン値
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API double ReadDigitalGain()
		{
			double ret = 0;

			// デジタルゲインを読み込み
			ret = _device.ReadDigitalGain();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			デジタルゲインを書き込み
		/// @param[in]		value	デジタルゲイン値
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void WriteDigitalGain(double value)
		{
			// デジタルゲインを書き込み
			_device.WriteDigitalGain(value);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			露光時間を読み込み
		/// @return			露光時間
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API double ReadExposureTime()
		{
			double ret = 0;

			// 露光時間を読み込み
			ret = _device.ReadExposureTime();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			露光時間を書き込み
		/// @param[in]		value	露光時間
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API void WriteExposureTime(double value)
		{
			// 露光時間を書き込み
			_device.WriteExposureTime(value);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			取り込み
		/// @return			画像のクラス
		////////////////////////////////////////////////////////////////////////////////
		GRABBER_API Image::CObject Capture()
		{
			Image::CObject ret;

			// 取り込み
			ret = _device.Capture();

			return ret;
		}
	}
}