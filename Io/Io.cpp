#include "pch.h"

#include "Io.h"
#include "Common/Version/Manager.h"
#include "Poling.h"
#include "Worker.h"

namespace Standard
{
	namespace Io
	{
		//! Ioの制御を行うクラス
		static Worker::CTemplate<Poling::Worker::CTemplate> _device;

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			バージョンのクラスを取得
		////////////////////////////////////////////////////////////////////////////////
		IO_API Version::CObject GetVersion()
		{
			Version::CObject ret;

			Version::CManager& versionManager = Version::CManager::Instance();

			// バージョンのクラスを取得
			ret = versionManager.GetVersion();

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			例外を通知する関数の登録
		/// @detail			例外の発生時に呼び出されたい関数を指定する
		/// @param[in]		object	呼び出されたい関数
		////////////////////////////////////////////////////////////////////////////////
		IO_API void AttachFunctionException(std::function<void(const Exception::CObject&)> object)
		{
			// 例外を通知する関数の登録
			_device.AttachFunctionException(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			例外を通知する関数の解除
		/// @detail			例外の発生時に呼び出される関数を解除する
		////////////////////////////////////////////////////////////////////////////////
		IO_API void DetachFunctionException()
		{
			// 例外を通知する関数の解除
			_device.DetachFunctionException();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			入力の変化を通知する関数の登録
		/// @detail			入力の変化時に呼び出されたい関数を指定する
		/// @param[in]		object	呼び出されたい関数
		////////////////////////////////////////////////////////////////////////////////
		IO_API void AttachFunctionInput(std::function<void(const Status::CInput&)> object)
		{
			// 入力の変化を通知する関数の登録
			_device.AttachFunctionInput(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			入力の変化を通知する関数の解除
		/// @detail			入力の変化時に呼び出される関数を解除する
		////////////////////////////////////////////////////////////////////////////////
		IO_API void DetachFunctionInput()
		{
			// 入力の変化を通知する関数の解除
			_device.DetachFunctionInput();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			初期化
		/// @param[in]		object	デフォルトの設定クラス
		////////////////////////////////////////////////////////////////////////////////
		IO_API void Initialize(const Setting::CDefault& object)
		{
			// 初期化
			_device.Initialize(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			破棄
		////////////////////////////////////////////////////////////////////////////////
		IO_API void Destroy()
		{
			// 破棄
			_device.Destroy();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			接続
		/// @param[in]		object	接続の設定クラス
		////////////////////////////////////////////////////////////////////////////////
		IO_API void Connect(const Setting::CConnect& object)
		{
			// 接続
			_device.Connect(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			切断
		////////////////////////////////////////////////////////////////////////////////
		IO_API void Disconnect()
		{
			// 切断
			_device.Disconnect();
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			入力を読み込み
		/// @param[in]		object	入力の設定クラス
		/// @return			IOの状態(入力)クラス
		////////////////////////////////////////////////////////////////////////////////
		IO_API Status::CInput ReadInput(const Setting::CInput& object)
		{
			Status::CInput ret;

			// 入力を読み込み
			ret = _device.ReadInput(object);

			return ret;
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			出力を書き込み
		/// @param[in]		object	IOの状態(出力)クラス
		////////////////////////////////////////////////////////////////////////////////
		IO_API void WriteOutput(const Status::COutput& object)
		{
			// 出力を書き込み
			_device.WriteOutput(object);
		}

		////////////////////////////////////////////////////////////////////////////////
		/// @brief			入力のトリガ待ち
		/// @param[in]		object	シグナルの設定クラス
		////////////////////////////////////////////////////////////////////////////////
		IO_API void TriggerInputPending(const Setting::CInputPending& object)
		{
			// 入力のトリガ待ち
			_device.TriggerInputPending(object);
		}
	}
}